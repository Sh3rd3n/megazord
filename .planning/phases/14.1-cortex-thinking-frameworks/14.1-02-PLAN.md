---
phase: 14.1-cortex-thinking-frameworks
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - skills/debug/SKILL.md
  - skills/go/SKILL.md
  - skills/go/executor.md
autonomous: true
requirements:
  - CORTEX-04

must_haves:
  truths:
    - "Debug mode uses Issue Tree + Ishikawa cause-category decomposition for non-trivial bugs"
    - "Debug mode skips formal Issue Tree decomposition when root cause is immediately obvious from stack trace"
    - "Issue Tree branches use software-adapted Ishikawa categories: Code, Data, Environment, Dependencies, Timing, State"
    - "The go orchestrator embeds CORTEX skill content in executor prompts when cortex_enabled is true"
  artifacts:
    - path: "skills/debug/SKILL.md"
      provides: "Debug skill with CORTEX-aware depth control for Issue Tree + Ishikawa"
      contains: "CORTEX-aware"
    - path: "skills/go/SKILL.md"
      provides: "Go orchestrator with CORTEX skill embedding protocol"
      contains: "skills/cortex/SKILL.md"
    - path: "skills/go/executor.md"
      provides: "Execution protocol documenting CORTEX skill embedding"
      contains: "cortex"
  key_links:
    - from: "skills/debug/SKILL.md"
      to: "Issue Tree"
      via: "CORTEX-aware activation condition"
      pattern: "CORTEX-aware|skip condition"
    - from: "skills/go/SKILL.md"
      to: "skills/cortex/SKILL.md"
      via: "orchestrator reads and embeds CORTEX content"
      pattern: "cortex.*SKILL"
---

<objective>
Update the debug skill with CORTEX-aware depth control and update the go orchestrator to embed CORTEX skill content in executor prompts.

Purpose: CORTEX-04 requires the debug skill's Issue Tree + Ishikawa to be conditionally applied based on complexity (skip for trivial bugs). The go orchestrator needs to read `skills/cortex/SKILL.md` and embed it as a `<cortex_protocol>` block in executor prompts when CORTEX is enabled, keeping the authoritative content in one place.

Output: Updated `skills/debug/SKILL.md`, updated `skills/go/SKILL.md`, updated `skills/go/executor.md`
</objective>

<execution_context>
@/Users/sh3rd3n/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sh3rd3n/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/14.1-cortex-thinking-frameworks/14.1-CONTEXT.md
@.planning/phases/14.1-cortex-thinking-frameworks/14.1-RESEARCH.md
@skills/debug/SKILL.md
@skills/go/SKILL.md
@skills/go/executor.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add CORTEX-aware depth control to debug skill</name>
  <files>skills/debug/SKILL.md</files>
  <action>
Update `skills/debug/SKILL.md` Step 5 (ROOT CAUSE) to add CORTEX-aware conditional activation of Issue Tree + Ishikawa decomposition.

**Before the "### Issue Tree Decomposition" heading in Step 5, add a CORTEX-aware activation section:**

```markdown
### CORTEX-Aware Depth Control

Apply Issue Tree + Ishikawa MECE decomposition when the issue is NOT trivially obvious. Use this decision logic:

**Full decomposition (apply Issue Tree + Ishikawa):**
- Stack trace spans multiple files or modules
- Error message is ambiguous or misleading
- Multiple possible root causes exist
- The issue involves timing, state, or environment factors
- Previous fix attempts have failed

**Skip formal decomposition:**
- Stack trace directly points to a single-line fix with an obvious cause (e.g., "Cannot read property 'x' of undefined at line 42" with a clear null check missing)
- Build error with a self-explanatory message (e.g., "Module not found: './missing-file'")
- Type error with an obvious type mismatch

When skipping, display: `> Issue Tree: Skipped (root cause obvious from {error type/stack trace})`

When applying, display: `> Issue Tree: Applying MECE decomposition with Ishikawa categories`
```

**Also add explicit CORTEX labeling to the existing Issue Tree section.** The Issue Tree and Ishikawa categories ARE the CORTEX-04 implementation. Add a note at the top of the "### Issue Tree Decomposition" section:

```markdown
> This is the CORTEX-04 implementation: structured root-cause analysis using Issue Tree (MECE decomposition) and Ishikawa cause categories adapted for software.
```

**Important boundary clarification.** Add a note after the Ishikawa categories table:

```markdown
**CORTEX boundary:** When `/mz:debug` is invoked manually, the debug skill owns the analysis â€” CORTEX classification from the executor is NOT applied separately. The debug skill's own systematic methodology (REPRODUCE -> ISOLATE -> ROOT CAUSE -> FIX) governs. When debugging happens during execution (executor encounters a bug and applies auto-fix deviation rules), the executor's CORTEX classification governs instead.
```

Do NOT modify any other part of the debug skill (Steps 1-4, Step 6, Step 7, Key Behaviors, Error Handling, Notes).
  </action>
  <verify>
Verify the debug skill contains the CORTEX-aware sections:
```bash
grep -c "CORTEX-Aware Depth Control" skills/debug/SKILL.md
grep -c "Skip formal decomposition" skills/debug/SKILL.md
grep -c "CORTEX-04" skills/debug/SKILL.md
grep -c "CORTEX boundary" skills/debug/SKILL.md
grep -c "## Step 3: REPRODUCE" skills/debug/SKILL.md
grep -c "## Step 6: FIX" skills/debug/SKILL.md
```
All counts >= 1. Steps 3 and 6 must still exist (not accidentally modified).
  </verify>
  <done>
`skills/debug/SKILL.md` Step 5 contains: CORTEX-Aware Depth Control section with full/skip decision logic, CORTEX-04 labeling on Issue Tree section, CORTEX boundary clarification for manual vs execution context. All other steps (1-4, 6, 7) and sections unchanged.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update go orchestrator to embed CORTEX skill content</name>
  <files>skills/go/SKILL.md, skills/go/executor.md</files>
  <action>
Update `skills/go/SKILL.md` and `skills/go/executor.md` to document and implement CORTEX skill embedding in executor prompts.

**In `skills/go/SKILL.md`:**

1. In Step 2 (Load Context and Validate), after the existing CORTEX configuration check (`config.quality.cortex`), add a CORTEX content loading step:

```markdown
If CORTEX is enabled (`cortex_enabled = true`):
- Read `{plugin_path}/skills/cortex/SKILL.md` content using the Read tool.
- This content will be embedded in the executor prompt as a `<cortex_protocol>` block.
```

2. In the "Spawn Executor" subsection of Step 6 Path A (Subagent Execution), update the Task prompt composition. After the existing `<execution_rules>` block, add a conditional `<cortex_protocol>` block:

```
<cortex_protocol>
{Content of skills/cortex/SKILL.md -- only included if cortex_enabled is true}
</cortex_protocol>
```

This goes AFTER `<execution_rules>` and BEFORE the Task tool call. Update the numbered list item that says "Compose the Task prompt with all content inline" to mention the CORTEX protocol block.

3. Similarly, in Step 6 Path B (Agent Teams Execution), update the executor teammate prompt structure to include the same `<cortex_protocol>` block after `<execution_rules>`.

4. Add a note in the "Notes" section at the bottom:
```markdown
- When CORTEX is enabled, the orchestrator reads `{plugin_path}/skills/cortex/SKILL.md` and embeds it as `<cortex_protocol>` in the executor prompt. This keeps the authoritative CORTEX content in one file while ensuring the executor receives it inline (required by the Task boundary constraint).
```

**In `skills/go/executor.md`:**

1. In the "Pre-spawn Checklist" section, add a step after reading the reviewer agent:
```markdown
6. If CORTEX is enabled: **Read** `{plugin_path}/skills/cortex/SKILL.md` into memory
7. **Compose** the Task prompt with all content embedded inline
```
(Renumber existing step 6 to 7.)

2. In the "Prompt Structure" section, add the `<cortex_protocol>` block after `<execution_rules>`:
```
<cortex_protocol>
{Content of skills/cortex/SKILL.md -- only included if cortex_enabled is true}
</cortex_protocol>
```

3. In the "Quality Integration" section under "### CORTEX Flag Forwarding", add:
```markdown
When `cortex_enabled` is `true`, the orchestrator also embeds the CORTEX skill content (`skills/cortex/SKILL.md`) as a `<cortex_protocol>` block in the executor prompt. The executor uses both the flag (from `<execution_rules>`) and the protocol content (from `<cortex_protocol>`) to apply CORTEX classification and thinking frameworks. The inline CORTEX section in the executor agent definition (`agents/mz-executor.md`) serves as the baseline; the `<cortex_protocol>` provides the authoritative reference.
```

Do NOT modify any unrelated sections in either file.
  </action>
  <verify>
Verify both files contain the CORTEX embedding documentation:
```bash
grep -c "cortex_protocol" skills/go/SKILL.md
grep -c "skills/cortex/SKILL.md" skills/go/SKILL.md
grep -c "cortex_protocol" skills/go/executor.md
grep -c "skills/cortex/SKILL.md" skills/go/executor.md
grep -c "CORTEX Flag Forwarding" skills/go/executor.md
grep -c "## Step 2: Load Context and Validate" skills/go/SKILL.md
grep -c "## Step 6: Execute Waves" skills/go/SKILL.md
```
All counts >= 1.
  </verify>
  <done>
`skills/go/SKILL.md` documents CORTEX skill loading in Step 2, embeds `<cortex_protocol>` in both subagent and Agent Teams executor prompts in Step 6, and notes the embedding pattern. `skills/go/executor.md` pre-spawn checklist includes CORTEX skill reading, prompt structure includes `<cortex_protocol>` block, and CORTEX Flag Forwarding section documents the dual content delivery (flag + protocol).
  </done>
</task>

</tasks>

<verification>
1. `skills/debug/SKILL.md` has CORTEX-aware depth control with skip/apply decision logic
2. `skills/debug/SKILL.md` labels Issue Tree + Ishikawa as CORTEX-04 implementation
3. `skills/debug/SKILL.md` has boundary clarification (manual debug vs execution context)
4. `skills/go/SKILL.md` loads CORTEX skill content when enabled
5. `skills/go/SKILL.md` embeds `<cortex_protocol>` in both subagent and teammate executor prompts
6. `skills/go/executor.md` documents CORTEX skill in pre-spawn checklist and prompt structure
7. No regressions in debug skill phases (REPRODUCE, ISOLATE, ROOT CAUSE, FIX all intact)
8. No regressions in go skill execution flow (all steps intact)
</verification>

<success_criteria>
- Debug skill applies Issue Tree + Ishikawa conditionally based on bug complexity (CORTEX-04)
- Debug skill has clear boundary: manual invocation = debug owns, execution context = executor CORTEX owns
- Go orchestrator embeds CORTEX skill content in executor prompts when enabled
- Execution protocol documents the CORTEX embedding pattern
- No functional changes to debug or go skill beyond CORTEX integration
</success_criteria>

<output>
After completion, create `.planning/phases/14.1-cortex-thinking-frameworks/14.1-02-SUMMARY.md`
</output>
