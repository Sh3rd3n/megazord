---
phase: 14.1-cortex-thinking-frameworks
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - skills/cortex/SKILL.md
  - agents/mz-executor.md
autonomous: true
requirements:
  - CORTEX-01
  - CORTEX-02
  - CORTEX-03
  - CORTEX-05

must_haves:
  truths:
    - "Complicated+ tasks produce a CORTEX header line with domain, key signals, and frameworks being applied"
    - "Complicated+ tasks produce an Inversion pre-mortem with 3 specific failure scenarios"
    - "Complicated+ tasks produce a Ladder of Inference assumption chain with data->interpretation->assumption->status for each assumption"
    - "Complicated+ tasks produce a Second-Order Thinking consequence trace with at least 2 cascading effects"
    - "Complex tasks produce a First Principles decomposition with irreducible truths before generating alternatives"
    - "Complex tasks produce an Abstraction Laddering WHY/HOW reframing before alternatives"
    - "Recurring-area tasks trigger Iceberg Model with EVENT/PATTERN/STRUCTURE/MENTAL-MODEL/LEVERAGE layers"
    - "Simple/Clear tasks produce NO visible CORTEX output"
    - "Classification uses concrete heuristic signals (LOC, file count, APIs, modules, pattern familiarity, test coverage, side effects, external deps)"
  artifacts:
    - path: "skills/cortex/SKILL.md"
      provides: "Authoritative CORTEX skill definition with all framework templates and classification heuristics"
      min_lines: 150
    - path: "agents/mz-executor.md"
      provides: "Executor agent with enhanced CORTEX protocol inline"
      contains: "CORTEX Classification"
  key_links:
    - from: "skills/cortex/SKILL.md"
      to: "agents/mz-executor.md"
      via: "CORTEX protocol content duplicated in executor for Task boundary compatibility"
      pattern: "CORTEX Classification"
    - from: "agents/mz-executor.md"
      to: "execution_rules"
      via: "cortex_enabled flag check"
      pattern: "cortex_enabled.*true"
---

<objective>
Create the CORTEX thinking frameworks skill and enhance the executor agent with structured thinking protocols from untools.co.

Purpose: CORTEX currently exists as a basic inline section in the executor. This plan creates a first-class CORTEX skill file as the authoritative source and enhances the executor's inline protocol with proper framework templates (Inversion, Ladder of Inference, Second-Order Thinking, First Principles, Abstraction Laddering, Iceberg Model) and a concrete multi-signal classification heuristic matrix.

Output: `skills/cortex/SKILL.md` (authoritative skill), updated `agents/mz-executor.md` (enhanced inline protocol)
</objective>

<execution_context>
@/Users/sh3rd3n/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sh3rd3n/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/14.1-cortex-thinking-frameworks/14.1-CONTEXT.md
@.planning/phases/14.1-cortex-thinking-frameworks/14.1-RESEARCH.md
@agents/mz-executor.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CORTEX skill with full framework protocol</name>
  <files>skills/cortex/SKILL.md</files>
  <action>
Create `skills/cortex/SKILL.md` as the authoritative CORTEX thinking frameworks skill. This is a reference protocol file consumed by the executor -- NOT a manually invocable skill. Use `disable-model-invocation: true` in frontmatter.

The skill file must contain these sections in order:

**1. Frontmatter:**
```yaml
---
name: cortex
description: Adaptive reasoning engine — classifies task complexity via Cynefin and applies structured thinking frameworks
disable-model-invocation: true
---
```

**2. Overview section:**
Brief description: CORTEX classifies every task through Cynefin domains (Clear/Complicated/Complex/Chaotic) and applies appropriate mental models from untools.co. It is a protocol reference consumed by the executor during task execution when `cortex_enabled: true`.

**3. Classification Heuristic Matrix (CORTEX-05):**
A multi-signal heuristic table with 8 dimensions. Each signal column maps to Clear/Complicated/Complex/Chaotic:

| Signal | Clear | Complicated | Complex | Chaotic |
|--------|-------|-------------|---------|---------|
| LOC estimate | <50 | 50-300 | >300 or new architecture | N/A (broken state) |
| Files affected | 1-2 | 3-5 | 6+ or new module structure | N/A |
| New APIs/interfaces | 0 | 1-2 internal | External API or new public interface | N/A |
| Module scope | Same module | 2-3 modules | 4+ modules or cross-system | N/A |
| Pattern familiarity | Well-known, done before | 2+ valid patterns to choose from | No clear pattern, novel territory | N/A |
| Existing test coverage | Tests exist, minor modification | Tests need modification | No existing test patterns | Tests failing on unrelated code |
| Side effects | None | Localized, predictable | Distributed, hard to trace | Cascading failures |
| External dependencies | None new | Internal packages | External services, 3rd-party APIs | External service down/corrupt |

Classification algorithm:
1. Evaluate each signal independently
2. Task domain = HIGHEST domain any signal triggers
3. Chaotic ONLY triggered by crisis signals (build broken, tests failing on unrelated code, external service down, data corruption, security incident) -- never by quantitative thresholds alone
4. When signals conflict, explain the override: `CORTEX: Complicated -- 30 LOC but new external API integration elevates from Clear`

**4. Classification Output Format:**
- Clear: `CORTEX -> Clear -- {2+ concrete signals}` (NO visible output beyond this internal classification -- user sees nothing)
- Complicated: `CORTEX -> Complicated | {signals} | Applying: {framework list}`
- Complex: `CORTEX -> Complex | {signals} | Applying: {framework list}`
- Chaotic: `CORTEX: Chaotic -- {description}. Requesting user input.` (STOP execution)

For Complicated+ tasks, the classification line is the `<summary>` of a collapsible `<details>` block.

**5. Post-Classification Protocol:**
- Clear: Execute directly. No framework output. No CORTEX output visible to user.
- Complicated: Output challenge block inside `<details>`, then execute.
- Complex: Output challenge block + complex analysis block inside `<details>`, select approach, proceed.
- Chaotic: STOP and request user input.

**6. Challenge Block Template (CORTEX-01) -- for Complicated+ tasks:**
```xml
<details>
<summary>CORTEX -> {domain} | {signals} | Applying: {framework list}</summary>

<challenge domain="{complicated|complex}">
INVERSION (Pre-mortem):
  1. "This fails when {specific scenario 1}"
  2. "This fails when {specific scenario 2}"
  3. "This fails when {specific scenario 3}"

ASSUMPTIONS (Ladder of Inference):
  For each key assumption:
  - Data: {observable fact}
  - Interpretation: {what we read into the data}
  - Assumption: {inference we're making}
  - Status: {verified (checked in code/docs) | unverified (guessed)}

SECOND-ORDER (Consequence trace):
  If we do X:
  -> First-order: {immediate effect}
  -> Second-order: {what follows from that}
  -> Third-order: {what follows from that} (if relevant)

COUNTER: {strongest argument against this approach}
VERDICT: proceed | modify | reject
</challenge>

</details>
```

Rules for the challenge block:
- INVERSION: exactly 3 pre-mortem failure scenarios, specific not vague. "This fails when..." not "This might fail"
- ASSUMPTIONS: trace chain from data through interpretation to assumption. Mark verified/unverified. Catches assumption jumps.
- SECOND-ORDER: follow consequence chain at least 2 steps. Surfaces cascading effects.
- COUNTER: genuine attack, not a softball
- VERDICT: honest assessment. If modify: state changes. If reject: explain, propose alternative.

**7. Complex Analysis Block Template (CORTEX-02) -- for Complex tasks only:**
```xml
<details>
<summary>CORTEX Complex Analysis</summary>

<complex-analysis>
FIRST-PRINCIPLES:
  Irreducible truths about this problem:
  1. {fundamental truth}
  2. {fundamental truth}
  3. {fundamental truth}

  Decomposition method: {Five Whys | Socratic Questioning}
  {Show the chain of questions that reached these fundamentals}

ABSTRACTION-LADDERING:
  WHY (move up): {What's the real problem behind the stated problem?}
  REFRAMED: {The problem restated at a higher abstraction level}
  HOW (move down): {What specific approaches address the reframed problem?}

ALTERNATIVES:
  1. {approach} -- tradeoffs: {pro/con}
  2. {approach} -- tradeoffs: {pro/con}
  3. {approach} -- tradeoffs: {pro/con}

SELECTED: {N} -- {rationale with evidence}
</complex-analysis>

</details>
```

**8. Iceberg Analysis Template (CORTEX-03):**
Trigger condition: task touches a module/area that was flagged as problematic in a prior SUMMARY.md (mentioned in "Deviations from Plan", "Issues Encountered", or "Deferred Issues" sections -- NOT merely listed as modified). This distinguishes recurring problems from normal development iteration.

```xml
<details>
<summary>CORTEX Iceberg Analysis: {area}</summary>

<iceberg area="{module/area name}">
EVENT: {What happened -- the surface symptom}
PATTERN: {Has this happened before? Evidence from SUMMARY.md, git history, or prior tasks}
STRUCTURE: {What system dynamics cause this pattern? Dependencies, coupling, tech debt, missing abstractions}
MENTAL-MODEL: {What assumption about this area keeps producing the pattern?}
LEVERAGE: {Where to intervene for a lasting fix, not just symptom treatment}
</iceberg>

</details>
```

Skip Iceberg Analysis on fresh tasks with no prior history.

**9. Anti-Patterns section:**
- Vague classification: always cite at least 2 concrete signals
- Framework theater: frameworks must produce insights, not boilerplate
- Over-classifying: do not inflate complexity to justify elaborate output
- Under-classifying: do not downplay complexity to avoid work
- CORTEX noise on Simple/Clear tasks: absolutely NO visible output

**10. Complementary Frameworks section:**
When they fit naturally, CORTEX may complement with:
- 5 Whys (during First Principles decomposition)
- MECE (during Issue Tree construction)
No other additions -- keep the set focused.

Per user decision (CONTEXT.md): Claude has discretion on exact structure per framework -- some benefit from rigid templates (Issue Tree), others from flowing analysis (First Principles). Claude has discretion on persisting analysis to file when it adds value (likely for Complex/Chaotic tasks that produce reusable insights).
  </action>
  <verify>
Verify the file exists and contains all required sections:
```bash
[ -f "skills/cortex/SKILL.md" ] && echo "FOUND" || echo "MISSING"
grep -c "disable-model-invocation: true" skills/cortex/SKILL.md
grep -c "INVERSION" skills/cortex/SKILL.md
grep -c "Ladder of Inference" skills/cortex/SKILL.md
grep -c "SECOND-ORDER" skills/cortex/SKILL.md
grep -c "FIRST-PRINCIPLES" skills/cortex/SKILL.md
grep -c "ABSTRACTION-LADDERING" skills/cortex/SKILL.md
grep -c "iceberg" skills/cortex/SKILL.md
grep -c "LOC estimate" skills/cortex/SKILL.md
wc -l skills/cortex/SKILL.md
```
All grep counts should be >= 1. Line count should be >= 150.
  </verify>
  <done>
`skills/cortex/SKILL.md` exists with: frontmatter (disable-model-invocation: true), classification heuristic matrix with 8 signals, classification output format, post-classification protocol, challenge block template with Inversion/Ladder/Second-Order, complex analysis block with First Principles/Abstraction Laddering, Iceberg Model template with trigger condition, anti-patterns section. File is >= 150 lines.
  </done>
</task>

<task type="auto">
  <name>Task 2: Enhance executor agent with full CORTEX protocol inline</name>
  <files>agents/mz-executor.md</files>
  <action>
Update the CORTEX Classification section in `agents/mz-executor.md` (currently lines 322-407) to contain the enhanced protocol from the new CORTEX skill. The executor MUST contain the full protocol inline because @-references do not work across Task tool boundaries.

**Replace the existing "CORTEX Classification" section** (from `## CORTEX Classification` through the end of `### Iceberg Model`) with the enhanced version. The new section should contain:

1. **Classification Activation** (same as current): When `cortex_enabled` is `true`, classify each task before execution.

2. **Classification Heuristic Matrix** (CORTEX-05 enhancement): Replace the current 4-row heuristic table with the full 8-signal matrix from `skills/cortex/SKILL.md`. Include the classification algorithm (evaluate independently, highest domain wins, Chaotic only from crisis signals, explain overrides).

3. **Classification Output Format**:
   - Clear: `CORTEX -> Clear -- {signals}` (internal only, NO visible output to user)
   - Complicated+: Full `<details>` collapsible block with CORTEX header as summary line
   - Format: `CORTEX -> {domain} | {signals} | Applying: {framework list}`

4. **Post-Classification Protocol** (same structure as current but enhanced):
   - Clear: Execute directly. No visible output.
   - Complicated: Output challenge block inside `<details>`, then execute.
   - Complex: Output challenge block + complex analysis block inside `<details>`, then execute.
   - Chaotic: STOP and display message.

5. **Challenge Block Format** (CORTEX-01 enhancement): Replace the current template with the enhanced version that includes:
   - INVERSION with explicit "This fails when..." pattern and 3 scenarios
   - ASSUMPTIONS with Data->Interpretation->Assumption->Status chain and verified/unverified markers
   - SECOND-ORDER with "If we do X -> First-order -> Second-order -> Third-order" cascade
   - COUNTER and VERDICT (same as current)
   - All wrapped in `<details>` collapsible block

6. **Complex Analysis Block** (CORTEX-02 enhancement): Replace the current template with:
   - FIRST-PRINCIPLES with irreducible truths and decomposition method (Five Whys / Socratic Questioning)
   - ABSTRACTION-LADDERING with WHY (move up) / REFRAMED / HOW (move down)
   - ALTERNATIVES with explicit tradeoffs
   - SELECTED with rationale and evidence
   - Wrapped in `<details>` collapsible block

7. **Iceberg Model** (CORTEX-03 enhancement): Update the trigger condition to be specific:
   - Trigger: task touches area flagged as problematic in prior SUMMARY.md ("Deviations from Plan", "Issues Encountered", or "Deferred Issues" -- NOT merely listed as modified)
   - Template: EVENT/PATTERN/STRUCTURE/MENTAL-MODEL/LEVERAGE
   - Wrapped in `<details>` collapsible block

Do NOT modify any other section of the executor agent file (Execution Flow, Commit Protocol, Deviation Rules, Review Protocol, TDD Protocol, Pushback Mandate, Anti-Sycophancy, Summary Creation, Self-Check, Teammate Mode -- all remain untouched).

**Important note:** Add a comment at the top of the CORTEX section: `<!-- Authoritative source: skills/cortex/SKILL.md — keep in sync -->` to document the duplication and maintenance requirement.
  </action>
  <verify>
Verify the executor file is valid and contains enhanced content:
```bash
grep -c "Authoritative source: skills/cortex/SKILL.md" agents/mz-executor.md
grep -c "LOC estimate" agents/mz-executor.md
grep -c "INVERSION (Pre-mortem)" agents/mz-executor.md
grep -c "ASSUMPTIONS (Ladder of Inference)" agents/mz-executor.md
grep -c "SECOND-ORDER (Consequence trace)" agents/mz-executor.md
grep -c "FIRST-PRINCIPLES" agents/mz-executor.md
grep -c "ABSTRACTION-LADDERING" agents/mz-executor.md
grep -c "iceberg" agents/mz-executor.md
grep -c "details>" agents/mz-executor.md
grep -c "## Pushback Mandate" agents/mz-executor.md
grep -c "## Execution Flow" agents/mz-executor.md
```
All counts >= 1. The Pushback Mandate and Execution Flow sections must still exist (not accidentally deleted).
  </verify>
  <done>
`agents/mz-executor.md` CORTEX Classification section is enhanced with: sync comment referencing skills/cortex/SKILL.md, 8-signal classification heuristic matrix, collapsible `<details>` output format, enhanced challenge block with named Inversion/Ladder/Second-Order frameworks, enhanced complex analysis with First Principles/Abstraction Laddering, Iceberg Model with specific trigger condition. All other executor sections (Execution Flow, Commit Protocol, Deviation Rules, Review Protocol, TDD Protocol, Pushback Mandate, Anti-Sycophancy, Summary Creation, Self-Check, Teammate Mode) are unchanged.
  </done>
</task>

</tasks>

<verification>
1. `skills/cortex/SKILL.md` exists with disable-model-invocation: true and >= 150 lines
2. `agents/mz-executor.md` contains enhanced CORTEX section with all 8 framework references
3. Both files contain identical framework templates (Inversion, Ladder, Second-Order, First Principles, Abstraction Laddering, Iceberg Model)
4. Executor retains all non-CORTEX sections intact (Execution Flow, Commit Protocol, etc.)
5. Classification heuristic uses 8 concrete signals (LOC, files, APIs, modules, pattern familiarity, test coverage, side effects, external deps)
6. Clear/Simple tasks produce NO visible CORTEX output
7. Complicated+ tasks produce collapsible `<details>` blocks
</verification>

<success_criteria>
- CORTEX skill file is a complete reference protocol with all framework templates and heuristics
- Executor agent inline CORTEX section matches the skill file content
- Classification uses multi-signal heuristics (CORTEX-05)
- Challenge block uses named frameworks: Inversion, Ladder of Inference, Second-Order Thinking (CORTEX-01)
- Complex analysis uses First Principles + Abstraction Laddering (CORTEX-02)
- Iceberg Model has specific recurring-area trigger condition (CORTEX-03)
- No regression in executor agent non-CORTEX functionality
</success_criteria>

<output>
After completion, create `.planning/phases/14.1-cortex-thinking-frameworks/14.1-01-SUMMARY.md`
</output>
