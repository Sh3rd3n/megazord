---
phase: 09-config-consumption-wiring
plan: 03
type: execute
wave: 2
depends_on:
  - "09-01"
files_modified:
  - skills/go/SKILL.md
  - skills/go/executor.md
  - skills/go/teams.md
  - skills/status/SKILL.md
  - skills/debug/SKILL.md
  - skills/verify/SKILL.md
autonomous: true
requirements:
  - CONF-03
  - CONF-02

must_haves:
  truths:
    - "/mz:go passes the resolved model when spawning executor and reviewer agents in subagent mode"
    - "/mz:go passes the resolved model when spawning executor and reviewer teammates in Agent Teams mode"
    - "/mz:go suggests /mz:verify but notes it is disabled when workflow.verifier is false"
    - "/mz:status includes a Config section showing active/inactive toggles at a glance"
    - "/mz:debug adapts its approach based on the quality.debug setting (systematic vs quick)"
    - "Manual /mz:verify always works regardless of workflow.verifier config setting"
  artifacts:
    - path: "skills/go/SKILL.md"
      provides: "Model-aware executor/reviewer spawning, verifier toggle in Next Up"
      contains: "resolveAgentModel"
    - path: "skills/status/SKILL.md"
      provides: "Config section showing active toggles"
      contains: "Config"
    - path: "skills/debug/SKILL.md"
      provides: "Debug mode wiring (systematic vs quick)"
      contains: "quality.debug"
  key_links:
    - from: "skills/go/SKILL.md"
      to: "agents/mz-executor.md"
      via: "Dynamic frontmatter rewrite before Task spawn"
      pattern: "model.*frontmatter"
    - from: "skills/status/SKILL.md"
      to: "megazord.config.json"
      via: "Config section reads toggles from loaded config"
      pattern: "model_profile|workflow|quality"
---

<objective>
Wire model selection and toggle gating into /mz:go, /mz:status, /mz:debug, and /mz:verify. After this plan, model_profile controls executor/reviewer models, workflow.verifier gates post-execution suggestions, debug mode controls debugging depth, and /mz:status shows config at a glance.

Purpose: Completes the "config consumption wiring" -- the second half targeting execution, status, debug, and verification skills.
Output: Updated SKILL.md files for go, status, debug, and verify skills.
</objective>

<execution_context>
@/Users/sh3rd3n/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sh3rd3n/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-config-consumption-wiring/09-01-SUMMARY.md
@src/lib/config.ts
@skills/go/SKILL.md
@skills/go/executor.md
@skills/go/teams.md
@skills/status/SKILL.md
@skills/debug/SKILL.md
@skills/verify/SKILL.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Wire model selection and verifier toggle into /mz:go</name>
  <files>
    skills/go/SKILL.md
    skills/go/executor.md
    skills/go/teams.md
  </files>
  <action>
### Part A: Model Selection in /mz:go (Subagent Path)

In `skills/go/SKILL.md`, modify **Step 6 > Path A: Subagent Execution > Spawn Executor** section.

Before the executor spawn (after reading agent files), add model resolution:

```markdown
### Resolve Models for Agents

Before spawning, determine models for this wave's agents:

1. Read `model_profile` and `model_overrides` from the loaded config.
2. Resolve executor model: check `model_overrides.executor`, fall back to profile mapping (quality->opus, balanced->sonnet, budget->haiku).
3. Update `{plugin_path}/agents/mz-executor.md` frontmatter `model` field to the resolved value.
4. If review is enabled, resolve reviewer model: check `model_overrides.reviewer`, fall back to profile mapping.
5. Update `{plugin_path}/agents/mz-reviewer.md` frontmatter `model` field to the resolved value.

Note: Model resolution is done ONCE per wave (before the first plan spawn), not per-plan.
```

Update the executor spawn:
- Change `subagent_type` from `"general-purpose"` to `"mz-executor"`
- Keep the prompt structure with `<plan>`, `<config>`, `<reviewer_agent>`, `<execution_rules>` tags
- The `<agent_role>` section is no longer needed when using the named subagent type (Claude Code loads the agent definition from the file). However, keep the agent definition embedding as a fallback: "If spawning with subagent_type='mz-executor' fails, fall back to subagent_type='general-purpose' with the agent definition embedded inline in `<agent_role>` tags."
- Note: The `<reviewer_agent>` section is still embedded inline in the executor's prompt because the reviewer is spawned BY the executor (nested spawn), not by the orchestrator. The executor needs the reviewer definition in its prompt text.

### Part B: Model Selection in /mz:go (Agent Teams Path)

In `skills/go/SKILL.md`, modify **Step 6 > Path B: Agent Teams Execution > 6. Spawn Teammates** section.

Before spawning teammates, add the same model resolution:

```markdown
### Resolve Models for Teammates

Before spawning, determine models for this wave's agents:

1. Resolve executor model and update `{plugin_path}/agents/mz-executor.md` frontmatter.
2. If review is enabled, resolve reviewer model and update `{plugin_path}/agents/mz-reviewer.md` frontmatter.
```

Update the teammate spawn:
- Change executor teammate spawn to use `subagent_type="mz-executor"` (if supported for teammates; otherwise keep inline embedding with fallback note)
- Change reviewer teammate spawn to use `subagent_type="mz-reviewer"` (same caveat)
- Add fallback: "If named subagent spawning does not work for teammates, use 'general-purpose' with inline embedding."

### Part C: Verifier Toggle in /mz:go

In `skills/go/SKILL.md`, modify **Step 9: Post-Execution Summary > Next Up block**.

Replace the current "If all plans complete" Next Up block with a conditional:

```markdown
Determine verifier suggestion based on config:

**If all plans complete AND `config.workflow.verifier` is true:**
\```
===============================================
> Next Up
**Verify Phase {N}** -- validate deliverables
`/mz:verify`
===============================================
\```

**If all plans complete AND `config.workflow.verifier` is false:**
\```
===============================================
> Next Up
**Phase {N} execution complete.** Verifier is disabled in config.
Run `/mz:plan` to advance to next phase, or `/mz:verify` to verify manually.
===============================================
\```
```

**IMPORTANT:** The `/mz:verify` skill itself is NEVER gated. It always works when manually invoked. Only the automated suggestion in /mz:go changes.

### Part D: Update executor.md and teams.md

In `skills/go/executor.md`, add a note in the spawning section about model selection:
- "The orchestrator resolves the executor model via config profile/overrides and updates the agent frontmatter before spawning."
- "Model selection is transparent to the executor agent -- it simply runs on whatever model the orchestrator configured."

In `skills/go/teams.md`, add a similar note about model selection in Agent Teams mode:
- "Before spawning teammates, the orchestrator updates agent frontmatter model fields based on config."
  </action>
  <verify>
    - `skills/go/SKILL.md` contains model resolution instructions in Path A (Subagent)
    - `skills/go/SKILL.md` contains model resolution instructions in Path B (Agent Teams)
    - `skills/go/SKILL.md` uses `subagent_type="mz-executor"` with fallback
    - `skills/go/SKILL.md` Step 9 checks `config.workflow.verifier` for Next Up
    - `skills/go/SKILL.md` mentions `/mz:verify` is always available manually when verifier is disabled
    - `skills/go/executor.md` notes model selection
    - `skills/go/teams.md` notes model selection
  </verify>
  <done>
    - /mz:go resolves and applies models for executor and reviewer agents in both subagent and teams modes
    - /mz:go conditionally suggests /mz:verify based on workflow.verifier config
    - /mz:verify remains always available when manually invoked (never gated)
    - executor.md and teams.md document model selection
    - Named subagent types used with fallback to general-purpose
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire debug mode in /mz:debug and add config section to /mz:status</name>
  <files>
    skills/debug/SKILL.md
    skills/status/SKILL.md
    skills/verify/SKILL.md
  </files>
  <action>
### Part A: Debug Mode Wiring in /mz:debug

In `skills/debug/SKILL.md`, add debug mode configuration awareness.

After **Step 2** (Gather Issue Context), add a new sub-step:

```markdown
### Debug Mode Configuration

Read `quality.debug` from `.planning/megazord.config.json` (if config exists). If config does not exist, default to "systematic".

**If mode is "systematic" (default):**
- Follow the full 4-phase approach (REPRODUCE -> ISOLATE -> ROOT CAUSE -> FIX)
- Display all phase banners
- No shortcuts -- every phase is executed

**If mode is "quick":**
- Allow shortcuts based on the issue type:
  - If the stack trace directly points to a single file and line: skip ISOLATE phase (go from REPRODUCE to ROOT CAUSE)
  - If the error is a build/compile error with a clear message: skip REPRODUCE phase (go directly to ISOLATE)
  - If root cause is obvious from the error message: skip ROOT CAUSE phase (go directly to FIX)
- Display abbreviated banners:
  \```
  > Quick Debug: {issue type}
  \```
- Only execute the phases that add value for this specific issue

Display the active mode:
\```
> Debug mode: {systematic | quick}
\```
```

**IMPORTANT:** `/mz:debug` always works when manually invoked, regardless of any config toggle. The `quality.debug` setting only controls the approach depth (systematic vs quick), not whether debugging is available.

### Part B: Config Section in /mz:status

In `skills/status/SKILL.md`, add a new **Config section** to **Step 5** (Compact Mode). Insert this section AFTER the "Recent Phases" section and BEFORE the "Last Error" section.

```markdown
### Config Section

Read the loaded config and display active toggle states:

\```
â–¸ Config
  Model:       {model_profile} ({resolved default model, e.g., "opus"})
  TDD:         {on | off}
  Review:      {auto | manual | off}
  Brainstorm:  {on | off}
  CORTEX:      {on | off}
  Debug:       {systematic | quick}
  Research:    {on | off}
  Plan check:  {on | off}
  Verifier:    {on | off}
\```

Map config values to display:
- `model_profile`: Show as "{profile} ({model name})" -- e.g., "quality (opus)", "balanced (sonnet)", "budget (haiku)"
- `quality.tdd`: true -> "on", false -> "off"
- `quality.review`: Show the enum value directly: "auto", "manual", or "off"
- `quality.brainstorming`: true -> "on", false -> "off"
- `quality.cortex`: true -> "on", false -> "off"
- `quality.debug`: Show the enum value directly: "systematic" or "quick"
- `workflow.research`: true -> "on", false -> "off"
- `workflow.plan_check`: true -> "on", false -> "off"
- `workflow.verifier`: true -> "on", false -> "off"

If `model_overrides` has any entries, display them after the Model line:
\```
  Overrides:   executor=opus, researcher=haiku
\```
Only show the Overrides line if model_overrides is non-empty. Omit entirely if no overrides are set.
```

Also add the Config section to **Step 6** (Verbose Mode) -- it should appear in both compact and verbose output since the user specifically requested it.

### Part C: Verifier Awareness Note in /mz:verify

In `skills/verify/SKILL.md`, add a brief note near the top (after the description paragraph, before Step 1) clarifying that this skill always works regardless of config:

```markdown
**Note:** This skill always works when invoked manually, regardless of the `workflow.verifier` config setting. The config toggle only controls whether `/mz:go` automatically suggests verification after execution.
```

This is a documentation-only change -- the skill's behavior does not change. It simply makes explicit what the user decided: manual skills are never gated by config.
  </action>
  <verify>
    - `skills/debug/SKILL.md` contains "quality.debug" or "debug mode" configuration reading
    - `skills/debug/SKILL.md` describes systematic vs quick behavior differences
    - `skills/status/SKILL.md` contains a "Config" section with toggle display
    - `skills/status/SKILL.md` shows model_profile, TDD, Review, Brainstorm, CORTEX, Debug, Research, Plan check, Verifier
    - `skills/status/SKILL.md` mentions model_overrides display
    - `skills/verify/SKILL.md` mentions the skill works regardless of config setting
  </verify>
  <done>
    - /mz:debug reads quality.debug config and adapts approach (systematic: full 4-phase, quick: allows shortcuts)
    - /mz:status shows a Config section with all 9 toggle states at a glance in both compact and verbose modes
    - /mz:status shows model_overrides when set
    - /mz:verify has explicit documentation that it works regardless of workflow.verifier config
    - No skill gates manual invocation behind config toggles
  </done>
</task>

</tasks>

<verification>
- skills/go/SKILL.md has model-aware spawning in both subagent and Agent Teams paths
- skills/go/SKILL.md has verifier toggle in Next Up suggestion
- skills/status/SKILL.md has Config section with all toggles displayed
- skills/debug/SKILL.md has debug mode wiring (systematic vs quick)
- skills/verify/SKILL.md clarifies it works regardless of config
- No skill blocks manual invocation based on config toggles
- All 7 toggles accounted for: research (already wired), plan_check (Plan 09-02), verifier (this plan), tdd (already wired), review (already wired), brainstorming (Plan 09-02), cortex (already wired), debug (this plan)
</verification>

<success_criteria>
- Model resolution integrated into /mz:go for both execution paths
- workflow.verifier toggle controls /mz:go's post-execution suggestion
- quality.debug enum controls debugging approach depth in /mz:debug
- /mz:status displays all config toggles in a compact Config section
- All config consumption wiring is complete -- every config field collected during /mz:init now drives behavior
</success_criteria>

<output>
After completion, create `.planning/phases/09-config-consumption-wiring/09-03-SUMMARY.md`
</output>
